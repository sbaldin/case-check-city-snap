<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Guide-Architect Frontend (MVP)</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; }
      .container { max-width: 720px; margin: 0 auto; }
      input, textarea, button { padding: .6rem .8rem; font-size: 1rem; }
      .row { display: flex; gap: .5rem; align-items: center; margin-bottom: .75rem; }
      .col { display: flex; flex-direction: column; gap: .5rem; }
      pre { background: #111; color: #0f0; padding: .75rem; border-radius: 6px; overflow: auto; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Guide-Architect (Frontend)</h1>
      <p>Простой UI для тестирования gateway-service. Введите адрес или координаты и отправьте запрос.</p>

      <div class="col">
        <div class="row">
          <label for="address">Адрес:</label>
          <input id="address" placeholder="Невский проспект 28, Санкт-Петербург" style="flex:1" />
        </div>
        <div class="row">
          <label for="lat">Широта:</label>
          <input id="lat" type="number" step="any" placeholder="59.935" />
          <label for="lon">Долгота:</label>
          <input id="lon" type="number" step="any" placeholder="30.325" />
        </div>
        <div class="row">
          <label for="image">Изображение (base64):</label>
          <input id="image" type="file" accept="image/*" />
        </div>
        <div class="row">
          <button id="send">Отправить</button>
          <span id="status"></span>
        </div>
        <h3>Ответ</h3>
        <pre id="output">{}</pre>
      </div>
    </div>

    <script>
      const API_BASE = (localStorage.getItem('API_BASE')) || 'http://localhost:8000';

      const addressEl = document.getElementById('address');
      const latEl = document.getElementById('lat');
      const lonEl = document.getElementById('lon');
      const imageEl = document.getElementById('image');
      const outputEl = document.getElementById('output');
      const statusEl = document.getElementById('status');

      async function fileToBase64(file) {
        if (!file) return null;
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result.split(',')[1]);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }

      document.getElementById('send').addEventListener('click', async () => {
        statusEl.textContent = 'Загрузка...';
        outputEl.textContent = '{}';
        try {
          const coords = (latEl.value && lonEl.value) ? { lat: Number(latEl.value), lon: Number(lonEl.value) } : undefined;
          const img64 = await fileToBase64(imageEl.files[0]);
          const payload = { address: addressEl.value || undefined, coordinates: coords, image_base64: img64 };
          const res = await fetch(`${API_BASE}/api/v1/building/info`, {
            method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)
          });
          const json = await res.json();
          outputEl.textContent = JSON.stringify(json, null, 2);
          statusEl.textContent = res.ok ? 'OK' : `Ошибка: ${res.status}`;
        } catch (e) {
          statusEl.textContent = 'Ошибка';
          outputEl.textContent = String(e);
        }
      });
    </script>
  </body>
</html>
